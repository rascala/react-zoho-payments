function zpayments(config) {
    const { wrapperRef, backdropRef, spinnerRef } = config;
    function _extends() {
        return _extends = Object.assign || function (e) {
            for (var t = 1; t < arguments.length; t++) {
                var n = arguments[t];
                for (var r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r])
            }
            return e
        }, _extends.apply(this, arguments)
    }
    function _setPrototypeOf(e, t) {
        return _setPrototypeOf = Object.setPrototypeOf || function (e, t) {
            return e.__proto__ = t, e
        }, _setPrototypeOf(e, t)
    }
    function _isNativeReflectConstruct() {
        if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
        if (Reflect.construct.sham) return !1;
        if ("function" == typeof Proxy) return !0;
        try {
            return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () { })), !0
        } catch (e) { return !1 }
    }
    function _construct(e, t, n) {
        return _construct = _isNativeReflectConstruct() ? Reflect.construct : function (e, t, n) {
            var r = [null]; r.push.apply(r, t);
            var o = new (Function.bind.apply(e, r));
            return n && _setPrototypeOf(o, n.prototype), o
        }, _construct.apply(null, arguments)
    }
    var id = 0;
    function _classPrivateFieldLooseKey(e) {
        return "__private_" + id++ + "_" + e
    }
    function _classPrivateFieldLooseBase(e, t) {
        if (!Object.prototype.hasOwnProperty.call(e, t))
            throw new TypeError("attempted to use private field on non-instance");
        return e
    }
    function isFunction(e) {
        return e && "function" == typeof e
    }
    var MAX_Z_INDEX = "2147483647",
        Dom = function () {
            function e() {
                this.wrapperElement = loadContainer()
            }
            var t = e.prototype;
            return t.loadWidgetFrame = function (e, t) {
                void 0 === t && (t = {});
                var n = t.rootElement, r = t.onLoad, o = t.onError, i = t.title,
                    s = void 0 === i ? "" : i, a = document.createElement("iframe");
                return a.setAttribute("src", e), a.setAttribute("title", s),
                    a.setAttribute("frameborder", "0"), isFunction(r) && (a.onload = r),
                    isFunction(o) && (a.onerror = o), n && n.appendChild(a),
                    this.frameElement = a,
                    a
            },
                t.showWidgetFrame = function () {
                    this.frameElement && (document.body.style.overflow = "hidden",
                        this.frameElement.style.cssText = "\n        position: fixed;\n        display: block;\n        top: 0; \n        left: 0; \n        height: 100%; \n        width: 100%; \n        z-index: " + MAX_Z_INDEX + " !important;\n      ")
                },
                t.hideWidgetFrame = function () {
                    this.frameElement && (document.body.style.overflow = "visible",
                        this.frameElement.style.cssText = "display: none")
                },
                t.loadBackdrop = function () {
                    document.getElementById("zpay-backdrop") || (this.bdElement = getBackdrop(),
                        this.wrapperElement.appendChild(this.bdElement))
                },
                t.removeBackdrop = function () {
                    var e; null == (e = this.bdElement) || e.remove()
                },
                t.loadSpinner = function () {
                    this.spinnerElement = getSpinner(),
                        this.wrapperElement.appendChild(this.spinnerElement)
                },
                t.removeSpinner = function () {
                    var e; null == (e = this.spinnerElement) || e.remove()
                }, e
        }();
    function getBackdrop() {
        var e = backdropRef; // document.createElement("DIV");
        // return e.id = "zpay-backdrop",
        // return e.style.cssText = "\n    position: fixed; \n    top: 0; \n    left: 0; \n    height: 100%; \n    width: 100%; \n    background: #040a22; \n    opacity: 0;\n    transition: opacity 200ms ease-in;\n    z-index: " + (MAX_Z_INDEX - 1) + " !important;\n  ",
        return setTimeout(function () {
            e.style.opacity = "0.5"
        }, 0),
            e
    }
    function getSpinner() {
        var e = spinnerRef; // document.createElement("DIV");
        // return e.id = "zpay-spinner",
        // return e.style.cssText = "\n    position: fixed;\n    top: 25%;\n    left: 50%;\n    padding: 10px;\n    width: 52px;\n    height: 52px;\n    border-radius: 50%;\n    background-color: white;\n    opacity: 0;\n    transition: opacity 300ms ease-in;\n    z-index: " + MAX_Z_INDEX + " !important;\n    transform: translateX(-50%)\n  ",
        return setTimeout(function () {
            e.style.opacity = "1"
        }, 0),
            e.innerHTML = '\n    <style>\n      @keyframes zspin {\n        0% {\n          transform: rotate(0deg);\n        }\n        100% {\n          transform: rotate(360deg);\n        }\n      }\n\n      .zpayments-loader-icon {\n        height: 32px;\n        width: 32px;\n        animation: zspin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n      }\n    </style>\n\n    <svg viewBox="0 0 512 512" class="zpayments-loader-icon">\n      <g>\n        <path d="M255.52.19c-141.39,0-256,114.62-256,256s114.63,256,256,256,256-114.63,256-256S396.92.19,255.52.19Zm0,56.89c110,0,199.13,89.16,199.13,199.13S365.5,455.34,255.52,455.34,56.4,366.19,56.4,256.21,145.55,57.08,255.52,57.08Z" fill="#ededf0"/>\n        <path d="M255.52.19a256,256,0,0,1,233.4,150.64,28.45,28.45,0,0,1-51.84,23.44A199.18,199.18,0,0,0,255.52,57.08a28.45,28.45,0,0,1,0-56.89Z" fill="#1e93ff"/>\n      </g>\n    </svg>\n  ',
            e
    }
    function loadContainer() {
        var e = wrapperRef; // document.createElement("DIV");
        // return e.id = "zpay-wrapper", document.body.prepend(e), e
        return e;
    }
    function getOrigin(e) {
        try {
            return new URL(e).origin
        } catch (e) { }
        return e
    }
    var CLOSE_ACTION = "close",
        CHARGE_ACTION = "charge",
        OPEN_ACTION = "open",
        WIDGET_BOOTED_ACTION = "widget_booted",
        WIDGET_BOOT_FAILED = "widget_boot_failed",
        NEEDS_SCA_ACTION = "needs_sca",
        SCA_SUCCESS_ACTION = "sca_success",
        SCA_FAILURE_ACTION = "sca_failure",
        GET_FINANCIAL_CONNECTIONS_ACCOUNTS = "get_financial_connections_accounts",
        SEND_FINANCIAL_CONNECTIONS_ACCOUNTS = "send_financial_connections_accounts",
        SETTINGS_MODULE_CHANGE_ACTION = "settings:module-change",
        CHARGE_VALIDATION_ERROR = "charge:validationerror",
        THREEDS_FAILURE_ACTION = "charge:threedserror",
        API_VERSION = "api/v1";
    function getCookie(e) {
        for (var t = e + "=", n = decodeURIComponent(document.cookie).split(";"), r = 0; r < n.length; r++) {
            for (var o = n[r]; " " == o.charAt(0);)
                o = o.substring(1);
            if (0 == o.indexOf(t))
                return o.substring(t.length, o.length)
        } return ""
    }
    function encode(e) {
        var t = []; for (var n in e) {
            var r = e[n]; if (r) {
                var o = encodeURIComponent(n), i = encodeURIComponent(r);
                t.push(o + "=" + i)
            }
        }
        return t.join("&")
    }
    var URL_QUERY_SPLIT_REGEX = /\?(.+)/;
    function constructUrlWithParams(e, t) {
        void 0 === e && (e = ""), void 0 === t && (t = {});
        var n = extractParamsFromURL(e),
            r = e.split(URL_QUERY_SPLIT_REGEX); if (e = r[0],
                t = _extends({}, n, t),
                Object.keys(t).length) {
            var o = encode(t); if (o) return e + "?" + o
        }
        return e
    }
    function extractParamsFromURL(e) {
        var t = "";
        try {
            t = new URL(e).search
        } catch (r) {
            try {
                t = new URL(e, window.location.origin).search
            } catch (e) {
                var n;
                return (null == (n = window.ZP_META) ? void 0 : n.is_development_or_local) && console.error(e),
                    {}
            }
        } if (t) {
            var r = t.split(URL_QUERY_SPLIT_REGEX)[1].split("&"), o = {};
            return r.forEach(function (e) {
                var t = e.split("="), n = t[0], r = t[1];
                o[void 0 === n ? "" : n] = decodeURIComponent(void 0 === r ? "" : r)
            }), o
        } return {}
    }
    function validateAndAppendFrameOrigin(e) {
        var t;
        void 0 === e && (e = "");
        var n = window.location.origin;
        return null != (t = e) && t.includes(n) ? e : [e, n].filter(Boolean).join(",")
    }
    var makeRequest$1 = function (e, t) {
        void 0 === t && (t = {});
        try {
            var n = window.ZP_META || {},
                r = n.account_id,
                o = n.merchant_onboarding,
                i = t.account_id || (void 0 === r ? "" : r) || (void 0 === o ? {} : o).account_id || "",
                s = /^https?:\/\//i.test(e);
            if (!s) {
                e = location.origin + "/" + API_VERSION + e;
                var a = {};
                i && (a.account_id = i),
                    e = constructUrlWithParams(e, a),
                    t.headers = {
                        "Content-Type": "application/json", "X-ZP-SOURCE": "zpclient", "X-ZOHO-Include-Formatted": !0
                    };
                var c = getCookie("zpcscook");
                c && (t.headers["X-ZCSRF-TOKEN"] = "zpcsparam=" + c);
                var d = t.body;
                d instanceof FormData ? delete t.headers["Content-Type"] : "string" == typeof d || s || (t.body = JSON.stringify(d))
            }
            return t.credentials = "same-origin",
                Promise.resolve(window.fetch(e, t)).then(function (e) {
                    return Promise.resolve(e.json()).then(function (t) {
                        if (e.ok) return t; throw t
                    })
                })
        } catch (e) { return Promise.reject(e) }
    };
    function maskUrl(e) {
        try {
            return e.replace(/\b\d{4}\.[a-zA-Z0-9]{32}\.[a-zA-Z0-9]{32}\b/g, "REDACTED")
        } catch (t) { return e }
    }
    var uploadErrors = function (e) {
        void 0 === e && (e = {}); try {
            var t, n = {
                body: constructPayload(e), method: "POST", account_id: e.accountId || (null == (t = window.ZP_META) ? void 0 : t.account_id) || ""
            };
            return Promise.resolve(makeRequest$1("/errors", n)).then(function () { })
        } catch (e) {
            return Promise.reject(e)
        }
    };
    function constructPayload(e) {
        var t = window,
            n = t.ZP_META,
            r = (n = void 0 === n ? {} : n).build_version,
            o = void 0 === r ? "" : r,
            i = t.navigator,
            s = void 0 === i ? {} : i,
            a = t.location, c = e.stack, d = void 0 === c ? "" : c,
            u = e.message, l = void 0 === u ? "" : u, h = e.identifier,
            f = void 0 === h ? "" : h, _ = e.serviceName, m = void 0 === _ ? "Preact Apps" : _,
            v = e.level, p = void 0 === v ? "high" : v, g = e.previous_routes, E = e.url;
        return _extends({
            url: void 0 === E ? maskUrl((void 0 === a ? {} : a).href) : E,
            browser: s.userAgent, build_label: o, service_name: m, message: l,
            level: p, previous_routes: g
        }, d && { trace: btoa(d) }, f && { identifier: f })
    }
    function logger() {
        var e = ["%cZohoPay Instance", "background-color: blue; color: white; border-radius:10px; padding: 0 6px;"],
            t = (window.ZP_META || {}).is_development_or_local, n = void 0 !== t && t;
        return {
            log: function () {
                var t; n && (t = console).log.apply(t, e.concat([].slice.call(arguments)))
            },
            error: function () {
                var t; n && (t = console).error.apply(t, e.concat([].slice.call(arguments)))
            },
            warn: function () {
                var t; n && (t = console).warn.apply(t, e.concat([].slice.call(arguments)))
            },
            uploadError: function () {
                var t, r = [].slice.call(arguments), o = r[0].message;
                uploadErrors.apply(void 0, r), n && (t = console).error.apply(t, e.concat([o]))
            }
        }
    }
    var logger$1 = logger(),
        Bus = function () {
            function e(e) {
                var t = this, n = e.src, r = e.targetWindow;
                if (this.listeners = {}, this.messageListener = function (e) {
                    if (e.origin === t.allowedOrigin) {
                        var n = e.data || {}, r = t.listeners[n.action];
                        return r ? r(n.payload) : void 0
                    }
                }, r && r.postMessage)
                    return this.addAllowedSites(n, r),
                        void window.addEventListener("message", this.messageListener);
                throw "Can`t enable cross-origin communication. This may happen when you are passing an invalid targetWindow during instantiation"
            }
            var t = e.prototype;
            return t.addAllowedSites = function (e, t) {
                var n = getOrigin(e);
                this.allowedOrigin = n, this.targetWindow = t
            },
                t.on = function (e, t) {
                    if (!e) throw "Event name is mandatory to register a event on the communication bus";
                    if (!t) throw "Event handler is mandatory to register a event on the communication bus (Event: " + e + ")";
                    this.listeners[e] && logger$1.log('A handler is already registered for the event, "' + e + '". Hence old handler will be overridden by the current one.'),
                        this.listeners[e] = t
                },
                t.send = function (e) {
                    this.targetWindow.postMessage(e, "*")
                },
                t.destroy = function () {
                    window.removeEventListener("message", this.messageListener)
                }, e
        }(), _getUrl$1 = _classPrivateFieldLooseKey("getUrl"),
        Onboarding = function () {
            function e(e) {
                Object.defineProperty(this, _getUrl$1, { value: _getUrl2$1 }),
                    this.onboardingFrameElement = null;
                var t = e || {}, n = t.frameorigin, r = void 0 === n ? "" : n,
                    o = t.baseUrl;
                this.dom = t.domHandler, this.frameorigin = r, this.baseUrl = o
            }
            var t = e.prototype;
            return t.open = function (e) {
                void 0 === e && (e = {});
                var t = e.selector;
                if ("string" == typeof t && (t = document.querySelector(t)), t) {
                    var n = _classPrivateFieldLooseBase(this, _getUrl$1)[_getUrl$1](e),
                        r = this.dom.loadWidgetFrame(n, {
                            rootElement: t, title: "Zoho Payments Account Onboarding"
                        });
                    r.style.cssText = "\n        width: 100%;\n        height: 100%;\n        border: none;\n      ";
                    var o = new Bus({
                        src: r.src, targetWindow: r.contentWindow
                    });
                    this.bus = o,
                        this.onboardingFrameElement = r
                }
            },
                t.on = function (e, t) {
                    isFunction(t) && this.bus && this.bus.on("onboarding:" + e, t)
                },
                t.close = function () {
                    var e, t; this.bus && (this.bus.listeners = {}),
                        null == (e = this.onboardingFrameElement) || null == (t = e.parentNode) || t.removeChild(this.onboardingFrameElement)
                },
                t.openInSameTab = function (e) {
                    void 0 === e && (e = {}),
                        this.openInTab(_extends({}, e, { target: "_self" }))
                },
                t.openInTab = function (e) {
                    void 0 === e && (e = {});
                    var t = e.account_id, n = e.service_name, r = e.target,
                        o = void 0 === r ? "_blank" : r,
                        i = _classPrivateFieldLooseBase(this, _getUrl$1)[_getUrl$1]({
                            account_id: t, service_name: n
                        });
                    window.open(i, o)
                },
                e
        }();
    function _getUrl2$1(e) {
        void 0 === e && (e = {});
        var t = window.location.host, n = e.account_id, r = void 0 === n ? "" : n,
            o = e.service_name, i = void 0 === o ? "" : o, s = r ? "/" + r : "",
            a = this.baseUrl + "/account/create" + s;
        return t.indexOf("csez.zohocorpin.com") > 0 && (a = "https://pay.csez.zohocorpin.com/account/create" + s),
            constructUrlWithParams(a, {
                service_name: i, frameorigin: validateAndAppendFrameOrigin(this.frameorigin)
            })
    }
    function formatEventName(e) {
        return e ? "settings:" + e : ""
    }
    var _getUrl = _classPrivateFieldLooseKey("getUrl"),
        Settings = function () {
            function e(e) {
                Object.defineProperty(this, _getUrl, { value: _getUrl2 }),
                    this.settingsFrameElement = null; var t = e || {},
                        n = t.frameorigin, r = void 0 === n ? "" : n,
                        o = t.baseUrl;
                this.dom = t.domHandler, this.frameorigin = r, this.baseUrl = o
            }
            var t = e.prototype;
            return t.open = function (e) {
                var t = this; void 0 === e && (e = {});
                var n = e.selector, r = e.module, o = void 0 === r ? "" : r,
                    i = e.account_id, s = void 0 === i ? "" : i, a = e.service_name,
                    c = void 0 === a ? "" : a; if ("string" == typeof n && (n = document.querySelector(n)), n) {
                        var d = _classPrivateFieldLooseBase(this, _getUrl)[_getUrl]({
                            account_id: s, module: o, service_name: c
                        }),
                            u = this.dom.loadWidgetFrame(d, {
                                rootElement: n, title: "Zoho Payments Settings",
                                onError: function (e) {
                                    var n, r; n = e,
                                        isFunction(r = t.bus.listeners[formatEventName("error")]) && r(n)
                                }
                            });
                        u.style.cssText = "\n        width: 100%;\n        height: 100%;\n        border: none;\n      ";
                        var l = new Bus({ src: u.src, targetWindow: u.contentWindow });
                        this.bus = l, this.settingsFrameElement = u
                    }
            },
                t.on = function (e, t) {
                    isFunction(t) && this.bus.on(formatEventName(e), t)
                },
                t.route = function (e) {
                    this.bus.send({ action: SETTINGS_MODULE_CHANGE_ACTION, payload: e })
                },
                t.close = function () {
                    var e, t; this.bus && (this.bus.listeners = {}),
                        null == (e = this.settingsFrameElement) || null == (t = e.parentNode) || t.removeChild(this.settingsFrameElement)
                },
                t.openInSameTab = function (e) {
                    void 0 === e && (e = {}),
                        this.openInTab(_extends({}, e, { target: "_self" }))
                },
                t.openInTab = function (e) {
                    void 0 === e && (e = {});
                    var t = e.account_id, n = e.module, r = e.service_name,
                        o = e.target, i = void 0 === o ? "_blank" : o,
                        s = _classPrivateFieldLooseBase(this, _getUrl)[_getUrl]({
                            account_id: t, module: n, service_name: r
                        }); window.open(s, i)
                }, e
        }();
    function _getUrl2(e) {
        var t, n = e.module, r = e.service_name, o = e.account_id || (null == (t = window.ZP_META) ? void 0 : t.account_id), i = "";
        return i = "/settings" + (o ? "/" + o : ""),
            this.baseUrl && (i = this.baseUrl + i),
            constructUrlWithParams(i, {
                module: void 0 === n ? "" : n, service_name: void 0 === r ? "" : r, frameorigin: validateAndAppendFrameOrigin(this.frameorigin)
            })
    }
    function filterOptions(e) {
        var t = {};
        return Object.keys(e).forEach(function (n) {
            var r = e[n]; "function" != typeof r && (t[n] = r)
        }), t
    }
    function appendAccIdForIframeUrl(e, t) {
        var n = e.split("?"), r = n[0], o = n[1], i = void 0 === o ? "" : o;
        return r = t ? r + "/" + t : r, i ? r + "?" + i : r
    }
    var WIDGET_CLOSED = {
        code: "widget_closed", message: "Checkout widget closed by user"
    },
        WIDGET_LOAD_PARAMS_MISSING = {
            code: "inadequate_params_to_load_widget", message: "Required params to load the widget are not found!"
        },
        WIDGET_FAILED_TO_LOAD = {
            code: "widget_failed_to_load", message: "Something went wrong and it looks like a temporary glitch. Please try again in some time."
        },
        WIDGET_VALIDATION_ERROR = {
            code: "widget_validation_error", message: "Something went wrong and it looks like a temporary glitch. Please try again in some time."
        },
        ACH_WIDGET_CLOSED_ERROR = {
            code: "ach_widget_validation_error", message: "Payment could not be processed as the session was terminated. You can try initiating the payment again."
        };
    function isEmptyObj(e) {
        return !e || Object.keys(e).every(function (t) {
            return !Object.keys(e[t] || {}).length
        })
    }
    var CHARGE_FRAME_URL = "",
        ChargeWidget = function () {
            function e(e) {
                var t = this;
                this._removeWidgetLoadingState = function () {
                    t.isLoading = !1, t.dom.removeSpinner()
                },
                    this._handleWidgetBootFailure = function () {
                        t.dom.removeBackdrop(), t._removeWidgetLoadingState(), t.isBootFailure = !0
                    },
                    this._handleClose = function () {
                        t.close()
                    };
                var n = e || {}, r = n.domHandler, o = n.accountId, i = void 0 === o ? "" : o,
                    s = n.frameorigin, a = void 0 === s ? "" : s, c = n.baseUrl, d = n.otherOptions,
                    u = void 0 === d ? {} : d, l = n.edition, h = void 0 === l ? "US" : l;
                this.trackerInfo = u.tracker, this.environment = u.__environment, this.dom = r,
                    this.frameorigin = a, this.baseUrl = c, this._getWidgetBaseUrl(),
                    this.edition = h, this.accountId = i, this.zApiKey = u.zApiKey || u.api_key,
                    this.isLoading = !0;
                var f = this._loadChargeFrame(i);
                this.bus = new Bus({ src: f.src, targetWindow: f.contentWindow }),
                    this.bus.on(WIDGET_BOOTED_ACTION, this._removeWidgetLoadingState),
                    this.bus.on(WIDGET_BOOT_FAILED, this._handleWidgetBootFailure)
            } var t = e.prototype;
            return t.requestPaymentMethod = function (e) {
                var t = this, n = e.tracker, r = void 0 === n ? {} : n;
                return new Promise(function (n, o) {
                    if ("IN" !== t.edition || t.accountId && t.zApiKey) {
                        var i = t.isLoading, s = t.isBootFailure;
                        return t.bus.on(CLOSE_ACTION, function () {
                            t._handleClose(), o(WIDGET_CLOSED)
                        }),
                            t.dom.loadBackdrop(), r.source_url || (r.source_url = location.href || ""),
                            isEmptyObj(r) || (t.trackerInfo = _extends({}, t.trackerInfo, r)),
                            t.paymentOptions = _extends({}, e, {
                                trackerInfo: t.trackerInfo, zApiKey: t.zApiKey, environment: t.environment
                            }),
                            i ? (logger$1.log("Frame is still loading"), t.dom.loadSpinner(), t.bus.on(WIDGET_BOOTED_ACTION, function () {
                                t._removeWidgetLoadingState(),
                                    t._requestPaymentMethod().then(n).catch(o)
                            }),
                                t.bus.on(WIDGET_BOOT_FAILED, function () {
                                    t._handleWidgetBootFailure(), o(WIDGET_FAILED_TO_LOAD)
                                })) : s && (t._handleWidgetBootFailure(), o(WIDGET_FAILED_TO_LOAD)),
                            t._requestPaymentMethod().then(n).catch(o)
                    } o(WIDGET_LOAD_PARAMS_MISSING)
                })
            }, t.verifyPaymentMethod = function (e) {
                var t = this;
                return this.dom.showWidgetFrame(),
                    new Promise(function (n, r) {
                        t.bus.send({
                            action: NEEDS_SCA_ACTION, payload: e
                        }), t.bus.on(SCA_SUCCESS_ACTION, function (e) { t._hideScaFrame(), n(e) }), t.bus.on(SCA_FAILURE_ACTION, function (e) { t._hideScaFrame(), r(e) })
                    })
            },
                t.collectBankAccounts = function (e) {
                    var t = this, n = (e || {}).client_secret,
                        r = {
                            clientSecret: void 0 === n ? "" : n
                        };
                    return new Promise(function (e, n) {
                        t.bus.send({
                            action: GET_FINANCIAL_CONNECTIONS_ACCOUNTS,
                            payload: r
                        }),
                            t.bus.on(SEND_FINANCIAL_CONNECTIONS_ACCOUNTS, function (t) {
                                void 0 === t && (t = {}),
                                    Object.keys(t).length ? e(t) : n(ACH_WIDGET_CLOSED_ERROR)
                            })
                    })
                },
                t.close = function () {
                    this._closeWrapper(),
                        this._closeForm(),
                        this.isFormVisible = !1
                },
                t._hideScaFrame = function () {
                    !this.isFormVisible && this.dom.hideWidgetFrame()
                },
                t._loadChargeFrame = function (e) {
                    var t = extractParamsFromURL(CHARGE_FRAME_URL),
                        n = window.location.origin;
                    t.frameorigin = validateAndAppendFrameOrigin(this.frameorigin),
                        t.host = n; var r = constructUrlWithParams(appendAccIdForIframeUrl(CHARGE_FRAME_URL, e), t),
                            o = this.dom.loadWidgetFrame(r, {
                                rootElement: this.dom.wrapperElement,
                                title: "Checkout - Powered by Zoho Payments"
                            });
                    return o.style.cssText = "display: none", o
                },
                t._requestPaymentMethod = function () {
                    var e = this; return new Promise(function (t, n) {
                        logger$1.log("Opening the widget"), e.isFormVisible = !0,
                            e.dom.showWidgetFrame();
                        var r = filterOptions(e.paymentOptions);
                        e.bus.send({ action: OPEN_ACTION, payload: r }),
                            e.bus.on(CHARGE_VALIDATION_ERROR, function (e) {
                                n(e || WIDGET_VALIDATION_ERROR)
                            }),
                            e.bus.on(THREEDS_FAILURE_ACTION, function (e) {
                                n(e)
                            }),
                            e.bus.on(CHARGE_ACTION, function (e) {
                                t(e)
                            })
                    })
                },
                t._closeWrapper = function () {
                    logger$1.log("Closing the widget"),
                        this.dom.hideWidgetFrame(),
                        this.dom.removeBackdrop(),
                        this.dom.removeSpinner()
                },
                t._closeForm = function () {
                    this.bus.send({ action: CLOSE_ACTION })
                },
                t._getWidgetBaseUrl = function () {
                    "" === CHARGE_FRAME_URL && (CHARGE_FRAME_URL = this.baseUrl + "/charge")
                },
                e
        }(),
        envHash = {
            sandbox: {
                subdomain: "pay", domain: "localzoho", domainDc: "com"
            },
            pre: { subdomain: "prepay", domain: "zoho" },
            production: { subdomain: "payments", domain: "zoho" }
        },
        dcHash = { US: "com", IN: "in" },
        DCs = ["com", "in"],
        environments = ["sandbox", "pre", "production"];
    function getWidgetBaseURL(e, t) {
        void 0 === t && (t = "production");
        var n = null == dcHash ? void 0 : dcHash[e];
        if (!DCs.includes(n)) return logger$1.error("Edition unavialble or incorrect, available editions US, IN."),
            "https://payments.zoho.com";
        environments.includes(t) || (t = "production");
        var r = envHash[t], o = r.subdomain, i = void 0 === o ? "payments" : o, s = r.domain, a = r.domainDc;
        return "US" !== e && "sandbox" === t && (i = i + "-" + n), "in" === n && "production" === t && (i = "payments"), "https://" + i + "." + (void 0 === s ? "zoho" : s) + "." + (void 0 === a ? dcHash[e] : a)
    }
    var makeRequest = function (e, t) {
        void 0 === t && (t = {});
        try {
            return t.credentials = "same-origin", Promise.resolve(window.fetch(e, t)).then(function (e) {
                return Promise.resolve(e.json()).then(function (t) { if (e.ok) return t; throw t })
            })
        } catch (e) {
            return Promise.reject(e)
        }
    },
        makeEventRequest = function (e, t, n) {
            try {
                void 0 === t && (t = {}); var r = (new Date).getTime();
                return t = Object.assign({}, {
                    timestamp: r
                }, t),
                    e = constructBaseUrl(n) + "/tracker/" + API_VERSION + e,
                    Promise.resolve(makeRequest(e, {
                        method: "POST", body: encode(t), headers: { "Content-Type": "application/x-www-form-urlencoded" }, mode: "cors"
                    }))
            } catch (e) {
                return Promise.reject(e)
            }
        };
    function constructBaseUrl(e) {
        void 0 === e && (e = {});
        var t = e.edition, n = e.environment;
        return getWidgetBaseURL(void 0 === t ? "US" : t, void 0 === n ? "production" : n)
    }
    function _catch$1(e, t) {
        try {
            var n = e()
        } catch (e) {
            return t(e)
        }
        return n && n.then ? n.then(void 0, t) : n
    }
    var sendEvent = function (e, t, n, r) {
        try {
            var o = {
                event_type: e, session_id: n.sessionId, account_id: n.accountId, timestamp: Date.now(), data: btoa(JSON.stringify(t))
            };
            return Promise.resolve(_catch$1(function () {
                return Promise.resolve(makeEventRequest("/event", o, r)).then(function () { })
            },
                function (t) {
                    throw logger$1.error("Error while sending event: ", e, t.message || t), t
                }))
        } catch (e) {
            return Promise.reject(e)
        }
    },
        commonjsGlobal = "undefined" != typeof globalThis ? globalThis : "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : {}; function createCommonjsModule(e) { var t = { exports: {} }; return e(t, t.exports), t.exports } var md5 = createCommonjsModule(function (module) { (function () { var ERROR = "input is invalid type", WINDOW = "object" == typeof window, root = WINDOW ? window : {}; root.JS_MD5_NO_WINDOW && (WINDOW = !1); var WEB_WORKER = !WINDOW && "object" == typeof self, NODE_JS = !root.JS_MD5_NO_NODE_JS && "object" == typeof process && process.versions && process.versions.node; NODE_JS ? root = commonjsGlobal : WEB_WORKER && (root = self); var COMMON_JS = !root.JS_MD5_NO_COMMON_JS && module.exports, ARRAY_BUFFER = !root.JS_MD5_NO_ARRAY_BUFFER && "undefined" != typeof ArrayBuffer, HEX_CHARS = "0123456789abcdef".split(""), EXTRA = [128, 32768, 8388608, -2147483648], SHIFT = [0, 8, 16, 24], OUTPUT_TYPES = ["hex", "array", "digest", "buffer", "arrayBuffer", "base64"], BASE64_ENCODE_CHAR = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""), blocks = [], buffer8; if (ARRAY_BUFFER) { var buffer = new ArrayBuffer(68); buffer8 = new Uint8Array(buffer), blocks = new Uint32Array(buffer) } !root.JS_MD5_NO_NODE_JS && Array.isArray || (Array.isArray = function (e) { return "[object Array]" === Object.prototype.toString.call(e) }), !ARRAY_BUFFER || !root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW && ArrayBuffer.isView || (ArrayBuffer.isView = function (e) { return "object" == typeof e && e.buffer && e.buffer.constructor === ArrayBuffer }); var createOutputMethod = function (e) { return function (t) { return new Md5(!0).update(t)[e]() } }, createMethod = function () { var e = createOutputMethod("hex"); NODE_JS && (e = nodeWrap(e)), e.create = function () { return new Md5 }, e.update = function (t) { return e.create().update(t) }; for (var t = 0; t < OUTPUT_TYPES.length; ++t) { var n = OUTPUT_TYPES[t]; e[n] = createOutputMethod(n) } return e }, nodeWrap = function nodeWrap(method) { var crypto = eval("require('crypto')"), Buffer = eval("require('buffer').Buffer"), nodeMethod = function (e) { if ("string" == typeof e) return crypto.createHash("md5").update(e, "utf8").digest("hex"); if (null == e) throw ERROR; return e.constructor === ArrayBuffer && (e = new Uint8Array(e)), Array.isArray(e) || ArrayBuffer.isView(e) || e.constructor === Buffer ? crypto.createHash("md5").update(new Buffer(e)).digest("hex") : method(e) }; return nodeMethod }; function Md5(e) { if (e) blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0, this.blocks = blocks, this.buffer8 = buffer8; else if (ARRAY_BUFFER) { var t = new ArrayBuffer(68); this.buffer8 = new Uint8Array(t), this.blocks = new Uint32Array(t) } else this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; this.h0 = this.h1 = this.h2 = this.h3 = this.start = this.bytes = this.hBytes = 0, this.finalized = this.hashed = !1, this.first = !0 } Md5.prototype.update = function (e) { if (!this.finalized) { var t, n = typeof e; if ("string" !== n) { if ("object" !== n) throw ERROR; if (null === e) throw ERROR; if (ARRAY_BUFFER && e.constructor === ArrayBuffer) e = new Uint8Array(e); else if (!(Array.isArray(e) || ARRAY_BUFFER && ArrayBuffer.isView(e))) throw ERROR; t = !0 } for (var r, o, i = 0, s = e.length, a = this.blocks, c = this.buffer8; i < s;) { if (this.hashed && (this.hashed = !1, a[0] = a[16], a[16] = a[1] = a[2] = a[3] = a[4] = a[5] = a[6] = a[7] = a[8] = a[9] = a[10] = a[11] = a[12] = a[13] = a[14] = a[15] = 0), t) if (ARRAY_BUFFER) for (o = this.start; i < s && o < 64; ++i)c[o++] = e[i]; else for (o = this.start; i < s && o < 64; ++i)a[o >> 2] |= e[i] << SHIFT[3 & o++]; else if (ARRAY_BUFFER) for (o = this.start; i < s && o < 64; ++i)(r = e.charCodeAt(i)) < 128 ? c[o++] = r : r < 2048 ? (c[o++] = 192 | r >> 6, c[o++] = 128 | 63 & r) : r < 55296 || r >= 57344 ? (c[o++] = 224 | r >> 12, c[o++] = 128 | r >> 6 & 63, c[o++] = 128 | 63 & r) : (r = 65536 + ((1023 & r) << 10 | 1023 & e.charCodeAt(++i)), c[o++] = 240 | r >> 18, c[o++] = 128 | r >> 12 & 63, c[o++] = 128 | r >> 6 & 63, c[o++] = 128 | 63 & r); else for (o = this.start; i < s && o < 64; ++i)(r = e.charCodeAt(i)) < 128 ? a[o >> 2] |= r << SHIFT[3 & o++] : r < 2048 ? (a[o >> 2] |= (192 | r >> 6) << SHIFT[3 & o++], a[o >> 2] |= (128 | 63 & r) << SHIFT[3 & o++]) : r < 55296 || r >= 57344 ? (a[o >> 2] |= (224 | r >> 12) << SHIFT[3 & o++], a[o >> 2] |= (128 | r >> 6 & 63) << SHIFT[3 & o++], a[o >> 2] |= (128 | 63 & r) << SHIFT[3 & o++]) : (r = 65536 + ((1023 & r) << 10 | 1023 & e.charCodeAt(++i)), a[o >> 2] |= (240 | r >> 18) << SHIFT[3 & o++], a[o >> 2] |= (128 | r >> 12 & 63) << SHIFT[3 & o++], a[o >> 2] |= (128 | r >> 6 & 63) << SHIFT[3 & o++], a[o >> 2] |= (128 | 63 & r) << SHIFT[3 & o++]); this.lastByteIndex = o, this.bytes += o - this.start, o >= 64 ? (this.start = o - 64, this.hash(), this.hashed = !0) : this.start = o } return this.bytes > 4294967295 && (this.hBytes += this.bytes / 4294967296 << 0, this.bytes = this.bytes % 4294967296), this } }, Md5.prototype.finalize = function () { if (!this.finalized) { this.finalized = !0; var e = this.blocks, t = this.lastByteIndex; e[t >> 2] |= EXTRA[3 & t], t >= 56 && (this.hashed || this.hash(), e[0] = e[16], e[16] = e[1] = e[2] = e[3] = e[4] = e[5] = e[6] = e[7] = e[8] = e[9] = e[10] = e[11] = e[12] = e[13] = e[14] = e[15] = 0), e[14] = this.bytes << 3, e[15] = this.hBytes << 3 | this.bytes >>> 29, this.hash() } }, Md5.prototype.hash = function () { var e, t, n, r, o, i, s = this.blocks; this.first ? t = ((t = ((e = ((e = s[0] - 680876937) << 7 | e >>> 25) - 271733879 << 0) ^ (n = ((n = (-271733879 ^ (r = ((r = (-1732584194 ^ 2004318071 & e) + s[1] - 117830708) << 12 | r >>> 20) + e << 0) & (-271733879 ^ e)) + s[2] - 1126478375) << 17 | n >>> 15) + r << 0) & (r ^ e)) + s[3] - 1316259209) << 22 | t >>> 10) + n << 0 : (e = this.h0, t = this.h1, t = ((t += ((e = ((e += ((r = this.h3) ^ t & ((n = this.h2) ^ r)) + s[0] - 680876936) << 7 | e >>> 25) + t << 0) ^ (n = ((n += (t ^ (r = ((r += (n ^ e & (t ^ n)) + s[1] - 389564586) << 12 | r >>> 20) + e << 0) & (e ^ t)) + s[2] + 606105819) << 17 | n >>> 15) + r << 0) & (r ^ e)) + s[3] - 1044525330) << 22 | t >>> 10) + n << 0), t = ((t += ((e = ((e += (r ^ t & (n ^ r)) + s[4] - 176418897) << 7 | e >>> 25) + t << 0) ^ (n = ((n += (t ^ (r = ((r += (n ^ e & (t ^ n)) + s[5] + 1200080426) << 12 | r >>> 20) + e << 0) & (e ^ t)) + s[6] - 1473231341) << 17 | n >>> 15) + r << 0) & (r ^ e)) + s[7] - 45705983) << 22 | t >>> 10) + n << 0, t = ((t += ((e = ((e += (r ^ t & (n ^ r)) + s[8] + 1770035416) << 7 | e >>> 25) + t << 0) ^ (n = ((n += (t ^ (r = ((r += (n ^ e & (t ^ n)) + s[9] - 1958414417) << 12 | r >>> 20) + e << 0) & (e ^ t)) + s[10] - 42063) << 17 | n >>> 15) + r << 0) & (r ^ e)) + s[11] - 1990404162) << 22 | t >>> 10) + n << 0, t = ((t += ((e = ((e += (r ^ t & (n ^ r)) + s[12] + 1804603682) << 7 | e >>> 25) + t << 0) ^ (n = ((n += (t ^ (r = ((r += (n ^ e & (t ^ n)) + s[13] - 40341101) << 12 | r >>> 20) + e << 0) & (e ^ t)) + s[14] - 1502002290) << 17 | n >>> 15) + r << 0) & (r ^ e)) + s[15] + 1236535329) << 22 | t >>> 10) + n << 0, t = ((t += ((r = ((r += (t ^ n & ((e = ((e += (n ^ r & (t ^ n)) + s[1] - 165796510) << 5 | e >>> 27) + t << 0) ^ t)) + s[6] - 1069501632) << 9 | r >>> 23) + e << 0) ^ e & ((n = ((n += (e ^ t & (r ^ e)) + s[11] + 643717713) << 14 | n >>> 18) + r << 0) ^ r)) + s[0] - 373897302) << 20 | t >>> 12) + n << 0, t = ((t += ((r = ((r += (t ^ n & ((e = ((e += (n ^ r & (t ^ n)) + s[5] - 701558691) << 5 | e >>> 27) + t << 0) ^ t)) + s[10] + 38016083) << 9 | r >>> 23) + e << 0) ^ e & ((n = ((n += (e ^ t & (r ^ e)) + s[15] - 660478335) << 14 | n >>> 18) + r << 0) ^ r)) + s[4] - 405537848) << 20 | t >>> 12) + n << 0, t = ((t += ((r = ((r += (t ^ n & ((e = ((e += (n ^ r & (t ^ n)) + s[9] + 568446438) << 5 | e >>> 27) + t << 0) ^ t)) + s[14] - 1019803690) << 9 | r >>> 23) + e << 0) ^ e & ((n = ((n += (e ^ t & (r ^ e)) + s[3] - 187363961) << 14 | n >>> 18) + r << 0) ^ r)) + s[8] + 1163531501) << 20 | t >>> 12) + n << 0, t = ((t += ((r = ((r += (t ^ n & ((e = ((e += (n ^ r & (t ^ n)) + s[13] - 1444681467) << 5 | e >>> 27) + t << 0) ^ t)) + s[2] - 51403784) << 9 | r >>> 23) + e << 0) ^ e & ((n = ((n += (e ^ t & (r ^ e)) + s[7] + 1735328473) << 14 | n >>> 18) + r << 0) ^ r)) + s[12] - 1926607734) << 20 | t >>> 12) + n << 0, t = ((t += ((i = (r = ((r += ((o = t ^ n) ^ (e = ((e += (o ^ r) + s[5] - 378558) << 4 | e >>> 28) + t << 0)) + s[8] - 2022574463) << 11 | r >>> 21) + e << 0) ^ e) ^ (n = ((n += (i ^ t) + s[11] + 1839030562) << 16 | n >>> 16) + r << 0)) + s[14] - 35309556) << 23 | t >>> 9) + n << 0, t = ((t += ((i = (r = ((r += ((o = t ^ n) ^ (e = ((e += (o ^ r) + s[1] - 1530992060) << 4 | e >>> 28) + t << 0)) + s[4] + 1272893353) << 11 | r >>> 21) + e << 0) ^ e) ^ (n = ((n += (i ^ t) + s[7] - 155497632) << 16 | n >>> 16) + r << 0)) + s[10] - 1094730640) << 23 | t >>> 9) + n << 0, t = ((t += ((i = (r = ((r += ((o = t ^ n) ^ (e = ((e += (o ^ r) + s[13] + 681279174) << 4 | e >>> 28) + t << 0)) + s[0] - 358537222) << 11 | r >>> 21) + e << 0) ^ e) ^ (n = ((n += (i ^ t) + s[3] - 722521979) << 16 | n >>> 16) + r << 0)) + s[6] + 76029189) << 23 | t >>> 9) + n << 0, t = ((t += ((i = (r = ((r += ((o = t ^ n) ^ (e = ((e += (o ^ r) + s[9] - 640364487) << 4 | e >>> 28) + t << 0)) + s[12] - 421815835) << 11 | r >>> 21) + e << 0) ^ e) ^ (n = ((n += (i ^ t) + s[15] + 530742520) << 16 | n >>> 16) + r << 0)) + s[2] - 995338651) << 23 | t >>> 9) + n << 0, t = ((t += ((r = ((r += (t ^ ((e = ((e += (n ^ (t | ~r)) + s[0] - 198630844) << 6 | e >>> 26) + t << 0) | ~n)) + s[7] + 1126891415) << 10 | r >>> 22) + e << 0) ^ ((n = ((n += (e ^ (r | ~t)) + s[14] - 1416354905) << 15 | n >>> 17) + r << 0) | ~e)) + s[5] - 57434055) << 21 | t >>> 11) + n << 0, t = ((t += ((r = ((r += (t ^ ((e = ((e += (n ^ (t | ~r)) + s[12] + 1700485571) << 6 | e >>> 26) + t << 0) | ~n)) + s[3] - 1894986606) << 10 | r >>> 22) + e << 0) ^ ((n = ((n += (e ^ (r | ~t)) + s[10] - 1051523) << 15 | n >>> 17) + r << 0) | ~e)) + s[1] - 2054922799) << 21 | t >>> 11) + n << 0, t = ((t += ((r = ((r += (t ^ ((e = ((e += (n ^ (t | ~r)) + s[8] + 1873313359) << 6 | e >>> 26) + t << 0) | ~n)) + s[15] - 30611744) << 10 | r >>> 22) + e << 0) ^ ((n = ((n += (e ^ (r | ~t)) + s[6] - 1560198380) << 15 | n >>> 17) + r << 0) | ~e)) + s[13] + 1309151649) << 21 | t >>> 11) + n << 0, t = ((t += ((r = ((r += (t ^ ((e = ((e += (n ^ (t | ~r)) + s[4] - 145523070) << 6 | e >>> 26) + t << 0) | ~n)) + s[11] - 1120210379) << 10 | r >>> 22) + e << 0) ^ ((n = ((n += (e ^ (r | ~t)) + s[2] + 718787259) << 15 | n >>> 17) + r << 0) | ~e)) + s[9] - 343485551) << 21 | t >>> 11) + n << 0, this.first ? (this.h0 = e + 1732584193 << 0, this.h1 = t - 271733879 << 0, this.h2 = n - 1732584194 << 0, this.h3 = r + 271733878 << 0, this.first = !1) : (this.h0 = this.h0 + e << 0, this.h1 = this.h1 + t << 0, this.h2 = this.h2 + n << 0, this.h3 = this.h3 + r << 0) }, Md5.prototype.hex = function () { this.finalize(); var e = this.h0, t = this.h1, n = this.h2, r = this.h3; return HEX_CHARS[e >> 4 & 15] + HEX_CHARS[15 & e] + HEX_CHARS[e >> 12 & 15] + HEX_CHARS[e >> 8 & 15] + HEX_CHARS[e >> 20 & 15] + HEX_CHARS[e >> 16 & 15] + HEX_CHARS[e >> 28 & 15] + HEX_CHARS[e >> 24 & 15] + HEX_CHARS[t >> 4 & 15] + HEX_CHARS[15 & t] + HEX_CHARS[t >> 12 & 15] + HEX_CHARS[t >> 8 & 15] + HEX_CHARS[t >> 20 & 15] + HEX_CHARS[t >> 16 & 15] + HEX_CHARS[t >> 28 & 15] + HEX_CHARS[t >> 24 & 15] + HEX_CHARS[n >> 4 & 15] + HEX_CHARS[15 & n] + HEX_CHARS[n >> 12 & 15] + HEX_CHARS[n >> 8 & 15] + HEX_CHARS[n >> 20 & 15] + HEX_CHARS[n >> 16 & 15] + HEX_CHARS[n >> 28 & 15] + HEX_CHARS[n >> 24 & 15] + HEX_CHARS[r >> 4 & 15] + HEX_CHARS[15 & r] + HEX_CHARS[r >> 12 & 15] + HEX_CHARS[r >> 8 & 15] + HEX_CHARS[r >> 20 & 15] + HEX_CHARS[r >> 16 & 15] + HEX_CHARS[r >> 28 & 15] + HEX_CHARS[r >> 24 & 15] }, Md5.prototype.toString = Md5.prototype.hex, Md5.prototype.digest = function () { this.finalize(); var e = this.h0, t = this.h1, n = this.h2, r = this.h3; return [255 & e, e >> 8 & 255, e >> 16 & 255, e >> 24 & 255, 255 & t, t >> 8 & 255, t >> 16 & 255, t >> 24 & 255, 255 & n, n >> 8 & 255, n >> 16 & 255, n >> 24 & 255, 255 & r, r >> 8 & 255, r >> 16 & 255, r >> 24 & 255] }, Md5.prototype.array = Md5.prototype.digest, Md5.prototype.arrayBuffer = function () { this.finalize(); var e = new ArrayBuffer(16), t = new Uint32Array(e); return t[0] = this.h0, t[1] = this.h1, t[2] = this.h2, t[3] = this.h3, e }, Md5.prototype.buffer = Md5.prototype.arrayBuffer, Md5.prototype.base64 = function () { for (var e, t, n, r = "", o = this.array(), i = 0; i < 15;)e = o[i++], t = o[i++], n = o[i++], r += BASE64_ENCODE_CHAR[e >>> 2] + BASE64_ENCODE_CHAR[63 & (e << 4 | t >>> 4)] + BASE64_ENCODE_CHAR[63 & (t << 2 | n >>> 6)] + BASE64_ENCODE_CHAR[63 & n]; return r + (BASE64_ENCODE_CHAR[(e = o[i]) >>> 2] + BASE64_ENCODE_CHAR[e << 4 & 63] + "==") }; var exports = createMethod(); COMMON_JS ? module.exports = exports : root.md5 = exports })() }), collectDeviceData = function (e, t) { try { var n, r, o, i, s, a, c, d; r = (n = e || {}).sessionId, o = n.accountId; var u = getTimeZone(); s = (i = window.screen || {}).height, a = i.width, c = i.pixelDepth, d = (i.orientation || {}).type; var l = getPlugins(), h = l ? md5(l) : "", f = { time_zone: u, language: navigator.language, plugins_hash: h, screen_resolution: { h: s, w: a, pd: c, ot: d } }; return sendEvent("device_data", f, { sessionId: r, accountId: o }, t), Promise.resolve() } catch (e) { return Promise.reject(e) } }; function getTimeZone() { var e = ""; try { e = (new Date).toString().match(/([-\+][0-9]+)\s/)[1] } catch (e) { } return e }
    function getPlugins() {
        var e = "";
        try {
            for (var t = navigator.plugins || [], n = 0; n < t.length; n++)e += n === t.length - 1 ? t[n].name : t[n].name + ","
        } catch (e) { } return e
    }
    function _catch(e, t) {
        try {
            var n = e()
        } catch (e) {
            return t(e)
        } return n && n.then ? n.then(void 0, t) : n
    }
    var createSession = function (e) {
        try {
            var t, n, r, o, i, s, a, c = e.accountId, d = e.trackerData, u = e.baseUrlParams;
            return n = void 0 === (t = d.action_type) ? "" : t,
                o = void 0 === (r = d.source_url) ? "" : r,
                s = void 0 === (i = d.referrer_urls) ? [] : i,
                Promise.resolve(_catch(function () {
                    return Promise.resolve(makeEventRequest("/session", {
                        account_id: c, action_type: n, source_url: btoa(o), referrer_urls: btoa(JSON.stringify(Array.from(location.ancestorOrigins || []).concat(s)))
                    }, u)).then(function (e) {
                        return null == (a = e) ? void 0 : a.session
                    })
                },
                    function (e) {
                        logger$1.uploadError({
                            message: e.message, stack: e.stack, serviceName: SERVICE_NAME_HASH[n] || "ZPay JS", level: "high"
                        })
                    }))
        } catch (e) { return Promise.reject(e) }
    },
        SERVICE_NAME_HASH = {
            sign_up: "Onboarding Widget",
            transaction: "Charge Widget",
            merchant_document_upload: "Settings Widget",
            bank_account_details_update: "Settings Widget"
        },
        EventManager = function () {
            function e(e) {
                var t = e.trackerData, n = e.baseUrlParams, r = void 0 === n ? {} : n;
                this.accountId = e.accountId, this.baseUrlParams = r, this.trackerData = t, this.sessionDetails = {
                    sessionId: ""
                }
            }
            var t = e.prototype;
            return t.startDataCollection = function (e) {
                try {
                    try {
                        return Promise.resolve(createSession(e).then(function (t) {
                            void 0 === t && (t = {});
                            try {
                                return Promise.resolve(collectDeviceData({
                                    sessionId: t.session_id,
                                    accountId: e.accountId
                                },
                                    e.baseUrlParams)).then(function () { return t })
                            } catch (e) {
                                return Promise.reject(e)
                            }
                        }))
                    } catch (e) { logger$1.error("Error while creating a payments session : ", e.message || e) } return Promise.resolve()
                } catch (e) { return Promise.reject(e) }
            },
                t.getSessionId = function () {
                    try {
                        var e, t = this;
                        return null != (e = t.sessionDetails) && e.sessionId ? Promise.resolve(t.sessionDetails.sessionId) : Promise.resolve(t.startDataCollection({
                            accountId: t.accountId, trackerData: t?.trackerData, baseUrlParams: t.baseUrlParams
                        })).then(function (e) {
                            return t.sessionDetails.sessionId = e.session_id, null == e ? void 0 : e.session_id
                        })
                    } catch (e) { return Promise.reject(e) }
                },
                t.sendBehaviourEvent = function (e) {
                    sendEvent(e.eventType, e.data, { sessionId: this.sessionDetails.sessionId }, this.baseUrlParams)
                },
                e
        }(),
        ZohoPayments = function () {
            class e {
                constructor(e) {
                    this.initOptions = e || {};
                    var t = this.initOptions, n = t._checkout, r = void 0 === n || n, o = t.accountId, i = void 0 === o ? "" : o, s = t.account_id, a = void 0 === s ? "" : s, c = t.frameorigin, d = void 0 === c ? "" : c, u = t.edition, l = void 0 === u ? "" : u, h = t.domain, f = t.otherOptions, _ = void 0 === f ? {} : f, m = l || (void 0 === h ? "" : h);
                    this.dom = new Dom;
                    var v = getWidgetBaseURL(m, null == _ ? void 0 : _.__environment);
                    r && (
                        this.charge = new ChargeWidget({ domHandler: this.dom, accountId: i || a, frameorigin: d, otherOptions: _, baseUrl: v, edition: m })),
                        this.onboarding = new Onboarding({ domHandler: this.dom, frameorigin: d, baseUrl: v }),
                        this.settings = new Settings({ domHandler: this.dom, frameorigin: d, baseUrl: l && _.__environment && v }
                        );
                }
            }
            var t = e.prototype;
            return t.requestPaymentMethod = function () {
                var e;
                return (e = this.charge).requestPaymentMethod.apply(e, arguments)
            },
                t.collectBankAccounts = function () {
                    var e;
                    return (e = this.charge).collectBankAccounts.apply(e, arguments)
                },
                t.close = function () {
                    var e; (e = this.charge).close.apply(e, arguments)
                },
                t.verifyPaymentMethod = function () {
                    var e;
                    return (e = this.charge).verifyPaymentMethod.apply(e, arguments)
                },
                t.destroy = function () { },
                t.getSessionId = function () {
                    try {
                        var e, t = this, n = arguments;
                        return t.eventInstance || (t.eventInstance = _construct(EventManager, n)),
                            Promise.resolve(null == (e = t.eventInstance) ? void 0 : e.getSessionId())
                    } catch (e) {
                        return Promise.reject(e)
                    }
                },
                e
        }();
    return ZohoPayments;
};

export { zpayments }